FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build

WORKDIR /workspace

# Copie tout le code source
COPY . .

WORKDIR /workspace/apps/migrations

# Restore les dépendances
RUN dotnet restore

# Mode développement - exécute les migrations et se termine proprement
CMD ["sh", "-c", "echo 'Démarrage des migrations...'; dotnet run; echo 'Migrations terminées avec le code de sortie:' $?; exit $?"]
